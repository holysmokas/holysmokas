import{x as f,L as w,F as d,j as g,D as p,U as b,M as y,O as E}from"./firebase-BtvxRjGj-Bmveahn2-DtNkYIDR.js";let m=!1;f(d,t=>{const n=window.location.pathname;m||(t&&n.includes("login.html")?window.location.href="/src/frontend/pages/dashboard.html":!t&&n.includes("dashboard.html")&&(window.location.href="/src/frontend/pages/login.html"))});async function v(t){try{(await(await fetch("http://localhost:8080/claim-projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.uid,email:t.email})})).json()).success&&console.log("âœ… Projects claimed successfully")}catch(n){console.error("Error claiming projects:",n)}}window.handleLogin=async function(t){t.preventDefault();const n=t.target,i=n.email.value,r=n.password.value,s=document.getElementById("loginBtn");s.disabled=!0,s.textContent="Signing In...";try{const e=(await w(d,i,r)).user;if(!e.emailVerified){c("warning","Email Not Verified","Please verify your email before logging in. Check your inbox for the verification link.",[{text:"Resend Verification Email",action:()=>{C(e)}},{text:"Close",action:closeAuthModal,primary:!0}]),await g(d),s.disabled=!1,s.textContent="Sign In";return}console.log("Login successful:",e.email),await v(e),c("success","Login Successful!","Redirecting to your dashboard..."),setTimeout(()=>{window.location.href="/src/frontend/pages/dashboard.html"},1e3)}catch(e){console.error("Login error:",e);let o="Login failed. Please try again.";e.code==="auth/invalid-credential"||e.code==="auth/wrong-password"?o="Invalid email or password. Please check your credentials.":e.code==="auth/user-not-found"?o="No account found with this email address.":e.code==="auth/too-many-requests"?o="Too many failed login attempts. Please try again later.":e.code==="auth/network-request-failed"?o="Network error. Please check your internet connection.":e.code==="auth/invalid-email"&&(o="Please enter a valid email address."),c("error","Login Failed",o),s.disabled=!1,s.textContent="Sign In"}};window.handleLogout=async function(){try{await g(d),console.log("Logout successful"),window.location.href="/src/frontend/pages/login.html"}catch(t){console.error("Logout error:",t),c("error","Logout Error","Error logging out. Please try again.")}};function c(t,n,i,r=null){const s=document.getElementById("authModal"),e=document.getElementById("authIcon"),o=document.getElementById("authTitle"),a=document.getElementById("authMessage"),l=document.getElementById("authModalButtons");s&&(t==="success"?(e.textContent="âœ“",e.style.background="var(--secondary)"):t==="error"?(e.textContent="âœ•",e.style.background="#ef4444"):t==="warning"&&(e.textContent="âš ",e.style.background="#f59e0b"),o.textContent=n,a.textContent=i,r&&l?(l.innerHTML="",r.forEach(h=>{const u=document.createElement("button");u.textContent=h.text,u.className=h.primary?"btn btn-primary":"btn btn-secondary",u.onclick=h.action,u.style.margin="0 0.5rem",l.appendChild(u)})):l&&(l.innerHTML='<button class="btn btn-primary" onclick="closeAuthModal()">Close</button>'),s.classList.add("show"))}window.closeAuthModal=function(){const t=document.getElementById("authModal");t&&t.classList.remove("show")};window.handleRegister=async function(t){t.preventDefault();const n=t.target,i=n.name.value,r=n.email.value,s=n.password.value,e=document.getElementById("registerBtn");if(s.length<6){c("error","Validation Error","Password must be at least 6 characters long.");return}e.disabled=!0,e.textContent="Creating Account...",m=!0;try{const o=(await p(d,r,s)).user;console.log("Account created:",o.email),await b(o,{displayName:i});const a={url:window.location.origin+"/src/frontend/pages/login.html",handleCodeInApp:!1};await y(o,a),console.log("Verification email sent to:",r),await g(d),await new Promise(l=>setTimeout(l,500)),m=!1,c("success","Account Created Successfully!",`A verification email has been sent to ${r}. Please check your inbox (and spam folder) and click the verification link before logging in.`,[{text:"Go to Login",action:()=>{closeAuthModal(),showLoginForm()},primary:!0}]),n.reset()}catch(o){console.error("Registration error:",o),m=!1;let a="Failed to create account. ";o.code==="auth/email-already-in-use"?a+="An account with this email already exists.":o.code==="auth/weak-password"?a+="Password should be at least 6 characters.":o.code==="auth/invalid-email"?a+="Invalid email address format.":o.code==="auth/operation-not-allowed"?a+="Email/password accounts are not enabled. Please contact support.":a+=o.message,c("error","Registration Failed",a),e.disabled=!1,e.textContent="Create Account"}finally{e.disabled=!1,e.textContent="Create Account"}};async function C(t){try{await y(t),c("success","Verification Email Sent","Please check your inbox for the verification link.")}catch(n){console.error("Error resending verification email:",n),c("error","Error","Failed to resend verification email. Please try again later.")}}window.handlePasswordReset=async function(t=null){let n=t;if(!n){I();return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){c("error","Invalid Email","Please enter a valid email address.");return}try{await E(d,n),c("success","Password Reset Email Sent",`A password reset link has been sent to ${n}. Please check your inbox and follow the instructions.`)}catch(i){console.error("Password reset error:",i);let r="Failed to send password reset email.";i.code==="auth/user-not-found"?r="No account found with this email address.":i.code==="auth/invalid-email"?r="Invalid email address format.":i.code==="auth/too-many-requests"?r="Too many requests. Please try again later.":r="An error occurred. Please contact support at (415) 691-7085.",c("error","Password Reset Failed",r)}};function I(){const t=document.getElementById("authModal"),n=document.getElementById("authIcon"),i=document.getElementById("authTitle"),r=document.getElementById("authMessage"),s=document.getElementById("authModalButtons");if(!t)return;n.textContent="ðŸ”‘",n.style.background="var(--primary)",i.textContent="Reset Your Password",r.innerHTML=`
        <div style="margin: 1.5rem 0;">
            <input 
                type="email" 
                id="resetEmailInput" 
                placeholder="Enter your email address"
                style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; font-family: inherit;"
            />
        </div>
    `,s.innerHTML="";const e=document.createElement("button");e.textContent="Send Reset Link",e.className="btn btn-primary",e.style.margin="0 0.5rem",e.onclick=async()=>{const a=document.getElementById("resetEmailInput"),l=a.value.trim();if(!l){a.style.borderColor="#ef4444";return}closeAuthModal(),await handlePasswordReset(l)};const o=document.createElement("button");o.textContent="Cancel",o.className="btn btn-secondary",o.style.margin="0 0.5rem",o.onclick=closeAuthModal,s.appendChild(e),s.appendChild(o),t.classList.add("show"),setTimeout(()=>{const a=document.getElementById("resetEmailInput");a&&(a.focus(),a.addEventListener("keypress",l=>{l.key==="Enter"&&e.click()}))},100)}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("authModal");t&&t.addEventListener("click",n=>{(n.target===t||n.target.classList.contains("modal-overlay"))&&closeAuthModal()})});
