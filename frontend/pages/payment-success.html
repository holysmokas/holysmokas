<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Successful - alimi.ai</title>
    <link rel="icon" type="image/svg+xml" href="/frontend/img/alimiai1.png" />
    <link rel="stylesheet" crossorigin href="/frontend/css/style.css">
</head>

<body>
    <nav>
        <div class="nav-container">
            <div class="logo">
                <a href="/" style="text-decoration: none; color: inherit;">
                    alimi.ai - Build. Connect. Bloom.
                    <img src="/frontend/img/alimiai1.png" alt="Woman looking surprised"
                        style="height:60px; vertical-align: middle; margin-left: 5px;">
                </a>
            </div>
            <div class="nav-cta">
                <a href="/login.html" class="btn btn-primary">Login to Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="container" style="min-height: 70vh; display: flex; align-items: center; justify-content: center;">
        <div style="max-width: 700px; text-align: center;">
            <div
                style="width: 120px; height: 120px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 2rem; font-size: 4rem; color: white;">
                ‚úì
            </div>

            <h1 style="font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem;">
                üéâ Payment Successful!
            </h1>

            <p style="font-size: 1.2rem; color: var(--gray); margin-bottom: 2rem;">
                Thank you for your payment! Your website is now being generated.
            </p>

            <!-- Generation Status -->
            <div id="generationStatus"
                style="background: #f0fdf4; border: 2px solid #10b981; border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
                <h2 style="color: #065f46; font-size: 1.5rem; margin-bottom: 1rem;">
                    ü§ñ What's Happening Now
                </h2>
                <div style="text-align: left; margin: 0 auto; max-width: 500px;">
                    <p id="step1"
                        style="color: #6b7280; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">‚ö°</span>
                        <span>Our Team is generating your custom website</span>
                    </p>

                    <p id="step2"
                        style="color: #6b7280; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">üöÄ</span>
                        <span>Deploying to live hosting</span>
                    </p>
                    <p id="step3" style="color: #6b7280; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">üìß</span>
                        <span>You'll receive an email when it's ready</span>
                    </p>
                </div>
            </div>

            <div style="background: #eff6ff; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                <p style="color: #1e40af; margin-bottom: 0;">
                    ‚è±Ô∏è <strong>Estimated Time:</strong> 5-15 minutes
                </p>
            </div>

            <div style="background: #fef3c7; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                <h3 style="color: #92400e; margin-bottom: 0.5rem;">üìß Check Your Email</h3>
                <p style="color: #78350f; margin-bottom: 0; font-size: 0.95rem;">
                    We've sent a confirmation to your email. You'll receive another email with your live website URL
                    once generation is complete.
                </p>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a href="/login.html" class="btn btn-primary"
                    style="font-size: 1.1rem; padding: 1rem 2rem;">
                    üìä Go to Dashboard
                </a>
                <a href="/" class="btn btn-secondary" style="font-size: 1.1rem; padding: 1rem 2rem;">
                    üè† Back to Home
                </a>
            </div>

            <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
                <p style="color: var(--gray); font-size: 0.9rem;">
                    Questions? Contact us at <a href="tel:4156917085" style="color: var(--primary);">(415) 691-7085</a>
                </p>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h4>alimi.ai</h4>
                <p>Professional websites for small businesses without monthly fees. Free hosting included. That's Cheap!
                </p>
            </div>
            <div class="footer-section">
                <h4>Contact</h4>
                <ul>
                    <li>Phone: (415) 691 - 7085</li>
                    <li>Email: contact@holysmokas.com</li>
                    <li>Hours: Mon-Fri 9am-6pm</li>
                </ul>
                <ul>
                    <li><a href="/#about">About Us</a></li>
                    <li><a href="/#portfolio">Portfolio</a></li>
                    <li><a href="/#pricing">Pricing</a></li>
                    <li><a href="/build.html">Contact</a></li>
                    <li><a href="/privacy.html">Privacy Policy</a></li>
                    <li><a href="/terms.html">Terms of Service</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 alimi.ai. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Get API URL based on environment
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:8080'
            : 'https://api.holysmokas.com';

        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');
        const projectId = urlParams.get('project_id');
        const bypassed = urlParams.get('bypassed');

        console.log('üìã Payment success page loaded');
        console.log('   Session ID:', sessionId);
        console.log('   Project ID:', projectId);
        console.log('   Bypassed:', bypassed);

        // Trigger generation automatically when page loads
        async function triggerGeneration() {
            if (!projectId) {
                console.error('‚ùå No project ID found in URL');
                return;
            }

            console.log('üöÄ Triggering website generation...');

            // Update UI to show generation started
            const step1 = document.getElementById('step1');
            if (step1) {
                step1.innerHTML = `
                    <span style="font-size: 1.5rem;">‚è≥</span>
                    <span><strong>Generating your website...</strong></span>
                `;
                step1.style.color = '#059669';
            }

            try {
                const response = await fetch(`${API_URL}/trigger-generation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        projectId: projectId,
                        sessionId: sessionId
                    })
                });

                const data = await response.json();
                console.log('üì° Trigger response:', data);

                if (data.success) {
                    if (data.alreadyGenerated) {
                        // Already done - show link
                        const statusDiv = document.getElementById('generationStatus');
                        statusDiv.innerHTML = `
                            <h2 style="color: #065f46; font-size: 1.5rem; margin-bottom: 1rem;">
                                ‚úÖ Your Website is Ready!
                            </h2>
                            <p style="margin-bottom: 1rem;">Your website has already been generated.</p>
                            <a href="${data.liveUrl}" target="_blank" class="btn btn-primary">
                                üåê View Your Website
                            </a>
                        `;
                    } else {
                        console.log('‚úÖ Generation started successfully');
                        // Update step 1 to show success
                        if (step1) {
                            step1.innerHTML = `
                                <span style="font-size: 1.5rem;">‚úÖ</span>
                                <span><strong>Generation started!</strong> This takes 5-15 minutes.</span>
                            `;
                        }
                    }
                } else {
                    console.error('‚ùå Trigger failed:', data.error);
                }
            } catch (error) {
                console.error('‚ùå Error triggering generation:', error);
            }
        }

        // Auto-trigger on page load
        window.addEventListener('DOMContentLoaded', () => {
            // Small delay to ensure page is fully loaded
            setTimeout(triggerGeneration, 1000);
        });
    </script>
</body>

</html>